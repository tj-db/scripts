<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boomerang Video</title>
    <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@5.0.0/dist/ffmpeg.min.js"></script>
    <style>
        #progressContainer {
            width: 100%;
            background-color: #f3f3f3;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 20px;
        }

        #progressBar {
            width: 0;
            height: 25px;
            background-color: #4caf50;
            text-align: center;
            color: white;
            line-height: 25px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>Upload a Video to Create a Boomerang Effect</h1>
    <input type="file" id="videoInput" accept="video/mp4">
    <button id="processButton">Create Boomerang Video</button>
    <div id="progressContainer" style="display: none;">
        <div id="progressBar">0%</div>
    </div>
    <video id="outputVideo" controls></video>

    <script>
        const { createFFmpeg, fetchFile } = FFmpeg;
        const ffmpeg = createFFmpeg({
            log: true,
            progress: (progress) => {
                const progressBar = document.getElementById("progressBar");
                const percent = (progress.ratio * 100).toFixed(2);
                progressBar.style.width = percent + "%";
                progressBar.textContent = percent + "%";
            }
        });

        document.getElementById('processButton').addEventListener('click', async () => {
            const fileInput = document.getElementById('videoInput');
            if (!fileInput.files.length) {
                alert("Please upload a video file first.");
                return;
            }
            const file = fileInput.files[0];

            document.getElementById('progressContainer').style.display = "block";
            await ffmpeg.load();
            document.getElementById('progressContainer').style.display = "none";

            ffmpeg.FS('writeFile', 'input.mp4', await fetchFile(file));

            let cmd = "[0:v]";
            for (let i = 0; i < 10; i++) {
                cmd += `reverse[v${i}];[0:v][v${i}]concat=n=2:v=1:a=0[vout]`;
            }

            await ffmpeg.run('-filter_complex', cmd, '-map', '[vout]', 'output.mp4');

            const data = ffmpeg.FS('readFile', 'output.mp4');
            const videoBlob = new Blob([data.buffer], { type: 'video/mp4' });
            const videoUrl = URL.createObjectURL(videoBlob);
            document.getElementById('outputVideo').src = videoUrl;
        });
    </script>
</body>
</html>
